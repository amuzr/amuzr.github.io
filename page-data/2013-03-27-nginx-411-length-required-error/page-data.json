{"componentChunkName":"component---src-templates-post-tsx","path":"/2013-03-27-nginx-411-length-required-error/","webpackCompilationHash":"b35400fc5437b66ce33f","result":{"data":{"markdownRemark":{"html":"<p><code class=\"language-text\">httpPost</code> 사용해서 이미지를 보내줄 때\n헤더 내용 중 <code class=\"language-text\">Content-Length</code> 값이 없어서 <em>(-1 리턴)</em> <code class=\"language-text\">chunked</code> 로 보내준다. <code class=\"language-text\">isChunked true</code></p>\n<p><strong>Apach Http</strong> 서버일때는 <code class=\"language-text\">chunked</code> 라도 그냥 처리를 해주었기 때문에문제가 없었지만,\nnginx 는 1.3.9 버전 이후부터 처리가 가능하다.\n그 이하 버전에서는 바이너리 설치하면서 모듈을 넣어주어야 한다.</p>\n<p>어플 단에서 간단하게 몇줄 추가해서 해결할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> byteArray <span class=\"token operator\">=</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">toByteArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> streamLength <span class=\"token operator\">=</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">toByteArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamBody</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ByteArrayInputStream</span><span class=\"token punctuation\">(</span>byteArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span>streamLength<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getContentLength</code>는 항상 <code class=\"language-text\">-1</code>을 리턴하게 되있는데 오버라이딩해서 파일크기를 넣어주면 이미지를 보낼 때 헤더에 <code class=\"language-text\">Content-Length</code>를 잘 넣어주고 <code class=\"language-text\">chunked</code>로 처리하지 않는다.</p>\n<p><strong>UPDATE</strong> 현재 2016-12-07 버전이 충분히 높아 문제 없다. 해당 이슈를 찾았던 document 도 찾을 수 없다.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"httpPost"}]},{"type":"text","value":" 사용해서 이미지를 보내줄 때\n헤더 내용 중 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Content-Length"}]},{"type":"text","value":" 값이 없어서 "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"(-1 리턴)"}]},{"type":"text","value":" "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"chunked"}]},{"type":"text","value":" 로 보내준다. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"isChunked true"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Apach Http"}]},{"type":"text","value":" 서버일때는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"chunked"}]},{"type":"text","value":" 라도 그냥 처리를 해주었기 때문에문제가 없었지만,\nnginx 는 1.3.9 버전 이후부터 처리가 가능하다.\n그 이하 버전에서는 바이너리 설치하면서 모듈을 넣어주어야 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"어플 단에서 간단하게 몇줄 추가해서 해결할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"byte"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" byteArray "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" stream"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toByteArray"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"final"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" streamLength "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" stream"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toByteArray"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"length"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"InputStreamBody"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ByteArrayInputStream"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"byteArray"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"image/jpeg\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" filename"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getContentLength"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"long"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"streamLength"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"getContentLength"}]},{"type":"text","value":"는 항상 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-1"}]},{"type":"text","value":"을 리턴하게 되있는데 오버라이딩해서 파일크기를 넣어주면 이미지를 보낼 때 헤더에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Content-Length"}]},{"type":"text","value":"를 잘 넣어주고 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"chunked"}]},{"type":"text","value":"로 처리하지 않는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"UPDATE"}]},{"type":"text","value":" 현재 2016-12-07 버전이 충분히 높아 문제 없다. 해당 이슈를 찾았던 document 도 찾을 수 없다."}]}],"data":{"quirksMode":false}},"excerpt":"사용해서 이미지를 보내줄 때\n헤더 내용 중  값이 없어서 (-1 리턴)  로 보내준다.  Apach Http 서버일때는  라도 그냥 처리를 해주었기 때문에문제가 없었지만,\nnginx 는 1.3.9 버전 이후부터 처리가 가능하다.\n그 이하 버전에서는 …","timeToRead":1,"frontmatter":{"title":"nginx 411 length required error","userDate":"2013 March 27","date":"2013-03-27 21:18:13 +0900","tags":["android","nginx"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAdABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQL/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABvZz2DDBZnRUA8wr/xAAaEAEBAAIDAAAAAAAAAAAAAAABABAhETFB/9oACAEBAAEFAjoNxew3OB2Y/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQETD/2gAIAQEABj8CLwU//8QAHRABAAICAgMAAAAAAAAAAAAAAQAhEUEQMVGBkf/aAAgBAQABPyHJyD7Dpp3jfHXEB2rxMhuXQosAxYLG9krDqf/aAAwDAQACAAMAAAAQvMrP/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAIBABAAMAAAYDAAAAAAAAAAAAAQARIRAxQVFhcYGx8P/aAAgBAQABPxDlRftBAVvB6PeEuBU1AlNLvsjgQe2NXSlogXbTp8TaYa5cpf5jNEFq88cD/9k=","aspectRatio":0.6960725075528701,"src":"/static/eccc6f8a0d254bba439789ec31657700/3c063/brandi-redd-aJTiW00qqtI-unsplash.jpg","srcSet":"/static/eccc6f8a0d254bba439789ec31657700/f8f18/brandi-redd-aJTiW00qqtI-unsplash.jpg 930w,\n/static/eccc6f8a0d254bba439789ec31657700/0e6ff/brandi-redd-aJTiW00qqtI-unsplash.jpg 1860w,\n/static/eccc6f8a0d254bba439789ec31657700/3c063/brandi-redd-aJTiW00qqtI-unsplash.jpg 3456w","sizes":"(max-width: 3456px) 100vw, 3456px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2013-03-27-nginx-411-length-required-error/","prev":null,"next":{"excerpt":"기존에 회사에서 아파치 httpd-2.2, php-5.2, mysql-5.1 을 사용하다가 자주 뻗기도 하고 방법을 찾기 어려웠다.\n결국 SSD 달린 새서버로 바꾸게 되어 nginx를 써보기로 했다.\n바이너리 설치도 있지만 기왕 최신껄 쓰는김에 계속…","timeToRead":2,"frontmatter":{"title":"CentOS6 에 yum 으로 nginx + php-fpm + mysql 설치하기","tags":["linux","nginx","php","mysql","centos"],"date":"2013-03-28 14:54:43 +0900","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":0.6960725075528701,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAdABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQL/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABvZz2DDBZnRUA8wr/xAAaEAEBAAIDAAAAAAAAAAAAAAABABAhETFB/9oACAEBAAEFAjoNxew3OB2Y/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQETD/2gAIAQEABj8CLwU//8QAHRABAAICAgMAAAAAAAAAAAAAAQAhEUEQMVGBkf/aAAgBAQABPyHJyD7Dpp3jfHXEB2rxMhuXQosAxYLG9krDqf/aAAwDAQACAAMAAAAQvMrP/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAIBABAAMAAAYDAAAAAAAAAAAAAQARIRAxQVFhcYGx8P/aAAgBAQABPxDlRftBAVvB6PeEuBU1AlNLvsjgQe2NXSlogXbTp8TaYa5cpf5jNEFq88cD/9k=","sizes":"(max-width: 3456px) 100vw, 3456px","src":"/static/eccc6f8a0d254bba439789ec31657700/3c063/brandi-redd-aJTiW00qqtI-unsplash.jpg","srcSet":"/static/eccc6f8a0d254bba439789ec31657700/f8f18/brandi-redd-aJTiW00qqtI-unsplash.jpg 930w,\n/static/eccc6f8a0d254bba439789ec31657700/0e6ff/brandi-redd-aJTiW00qqtI-unsplash.jpg 1860w,\n/static/eccc6f8a0d254bba439789ec31657700/3c063/brandi-redd-aJTiW00qqtI-unsplash.jpg 3456w"}}}},"fields":{"layout":"post","slug":"/2013-03-28-install-nginxphpfpmmysql-on-centos6-yum/","collection":"content"}},"primaryTag":"android"}}}